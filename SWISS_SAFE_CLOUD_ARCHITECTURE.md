# ğŸ—ï¸ Architecture MedAnnot - Swiss Safe Cloud

## ğŸ“Š SpÃ©cifications pour 50+ abonnÃ©s

### Objectifs
- âœ… Zero lag (response time < 200ms)
- âœ… 99.9% uptime
- âœ… Auto-scaling (jusqu'Ã  500+ utilisateurs)
- âœ… Backup automatisÃ©
- âœ… Monitoring complet

---

## ğŸ¯ Architecture RecommandÃ©e

### Option A: Kubernetes (RecommandÃ© pour scaling)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SWISS SAFE CLOUD                             â”‚
â”‚                        (GenÃ¨ve/Zurich)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸŒ medannot.ch (DNS chez Infomaniak)                          â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Load Balancer (Swiss Safe Cloud)                      â”‚   â”‚
â”‚  â”‚  â€¢ SSL Termination                                      â”‚   â”‚
â”‚  â”‚  â€¢ Health checks                                        â”‚   â”‚
â”‚  â”‚  â€¢ DDoS protection                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Kubernetes Cluster (3 nodes)                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Nginx Ingress Controller                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Rate limiting                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Compression gzip/brotli                      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                       â”‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  MedAnnot API Pods (3+ replicas)               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Node.js + Express                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ PM2 cluster mode                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Auto-scaling: 3-10 pods                     â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                       â”‚                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Frontend Pods (2+ replicas)                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Nginx + static files                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CDN ready                                   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PostgreSQL HA Cluster (Primary + 2 Replicas)          â”‚   â”‚
â”‚  â”‚  â€¢ 4 vCPU / 8GB RAM / 100GB SSD                        â”‚   â”‚
â”‚  â”‚  â€¢ Streaming replication                               â”‚   â”‚
â”‚  â”‚  â€¢ Automated backups (4x/jour)                         â”‚   â”‚
â”‚  â”‚  â€¢ Point-in-time recovery                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Redis Cluster (3 nodes)                               â”‚   â”‚
â”‚  â”‚  â€¢ Sessions                                            â”‚   â”‚
â”‚  â”‚  â€¢ Cache (patients/annotations)                        â”‚   â”‚
â”‚  â”‚  â€¢ Rate limiting counters                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Monitoring Stack                                       â”‚   â”‚
â”‚  â”‚  â€¢ Prometheus (metrics)                                 â”‚   â”‚
â”‚  â”‚  â€¢ Grafana (dashboards)                                 â”‚   â”‚
â”‚  â”‚  â€¢ Loki (logs aggregation)                              â”‚   â”‚
â”‚  â”‚  â€¢ AlertManager (alerting)                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ressources nÃ©cessaires (Option A)

| Composant | CPU | RAM | Stockage | Prix/mois |
|-----------|-----|-----|----------|-----------|
| K8s Cluster (3 nodes) | 6 vCPU | 12 GB | 150 GB | ~45 CHF |
| PostgreSQL HA | 4 vCPU | 8 GB | 100 GB | ~35 CHF |
| Redis Cluster | 2 vCPU | 4 GB | 20 GB | ~20 CHF |
| Load Balancer | - | - | - | ~10 CHF |
| Monitoring | 2 vCPU | 4 GB | 50 GB | ~20 CHF |
| **Total** | **14 vCPU** | **28 GB** | **320 GB** | **~130 CHF** |

---

### Option B: VMs Classiques (Plus simple, moins cher)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 SWISS SAFE CLOUD                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸŒ medannot.ch                                             â”‚
â”‚       â”‚                                                     â”‚
â”‚       â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Load Balancer                                      â”‚   â”‚
â”‚  â”‚  â€¢ SSL + Health checks                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚     â”‚                       â”‚                               â”‚
â”‚     â–¼                       â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  App VM #1  â”‚      â”‚  App VM #2  â”‚                      â”‚
â”‚  â”‚  (Primary)  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ (Secondary)â”‚                      â”‚
â”‚  â”‚             â”‚      â”‚             â”‚                      â”‚
â”‚  â”‚ â€¢ Node.js   â”‚      â”‚ â€¢ Node.js   â”‚                      â”‚
â”‚  â”‚ â€¢ Nginx     â”‚      â”‚ â€¢ Nginx     â”‚                      â”‚
â”‚  â”‚ â€¢ PM2       â”‚      â”‚ â€¢ PM2       â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                     â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                    â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚  PostgreSQL VM      â”‚                             â”‚
â”‚         â”‚  (ManagÃ© ou local)  â”‚                             â”‚
â”‚         â”‚                     â”‚                             â”‚
â”‚         â”‚ â€¢ Primary + Replica â”‚                             â”‚
â”‚         â”‚ â€¢ Backups auto      â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ressources nÃ©cessaires (Option B)

| Composant | CPU | RAM | Stockage | Prix/mois |
|-----------|-----|-----|----------|-----------|
| App VM #1 | 2 vCPU | 4 GB | 50 GB | ~20 CHF |
| App VM #2 | 2 vCPU | 4 GB | 50 GB | ~20 CHF |
| PostgreSQL | 2 vCPU | 4 GB | 100 GB | ~25 CHF |
| Load Balancer | - | - | - | ~10 CHF |
| **Total** | **6 vCPU** | **12 GB** | **200 GB** | **~75 CHF** |

---

## ğŸ¯ Recommandation

**Pour dÃ©marrer avec 50 abonnÃ©s**: **Option B** (VMs)
- Plus simple Ã  gÃ©rer
- Moins cher (~75 CHF/mois)
- Facilement upgradable vers K8s plus tard

**Pour scaler Ã  500+**: Migrer vers **Option A** (Kubernetes)

---

## ğŸ“‹ Sps Swagger Safe Cloud Ã  commander

### Option B (RecommandÃ©e pour dÃ©marrer)

1. **Compute - 2x Instances**
   - Type: ssc.medium (2 vCPU, 4 GB RAM)
   - OS: Ubuntu 22.04 LTS
   - Disk: 50 GB SSD
   - Localisation: GenÃ¨ve
   - Prix: ~20 CHF/unitÃ©

2. **Database - PostgreSQL ManagÃ©**
   - Version: 15
   - Type: ssc.db.small (2 vCPU, 4 GB RAM)
   - Storage: 100 GB
   - HA: Active/Standby (replica)
   - Backups: 4x/jour, 30 jours rÃ©tention
   - Prix: ~35 CHF

3. **Load Balancer**
   - Type: Layer 7 (HTTP/HTTPS)
   - SSL: Let's Encrypt auto
   - Health checks: HTTP/TCP
   - Prix: ~10 CHF

4. **Object Storage (optionnel pour fichiers)**
   - 50 GB
   - S3 compatible
   - Prix: ~5 CHF

**Total mensuel estimÃ©: ~90-100 CHF**

---

## ğŸš€ Avantages Swiss Safe Cloud vs Infomaniak

| Feature | Infomaniak | Swiss Safe Cloud |
|---------|-----------|------------------|
| Localisation | ğŸ‡¨ğŸ‡­ Suisse | ğŸ‡¨ğŸ‡­ Suisse |
| Kubernetes | âŒ Non natif | âœ… ManagÃ© |
| Auto-scaling | âŒ Manuel | âœ… Automatique |
| PostgreSQL HA | âŒ Simple | âœ… Cluster |
| Monitoring | âŒ Basique | âœ… IntÃ©grÃ© |
| Support K8s | âŒ | âœ… Expert |
| ISO 27001 | âœ… | âœ… |
| Finma conforme | âœ… | âœ… |

---

## ğŸ“ Fichiers Ã  crÃ©er

Je vais crÃ©er:
1. `docker-compose.yml` - pour dÃ©ploiement simple
2. `Dockerfile` - pour conteneurisation
3. `k8s/` - manifests Kubernetes
4. `scripts/deploy-swiss-safe-cloud.sh` - dÃ©ploiement automatique
5. `.github/workflows/deploy.yml` - CI/CD GitHub Actions
6. `SWISS_SAFE_CLOUD_DEPLOY.md` - guide complet

Tu veux que je commence par quelle option (A ou B) ?
